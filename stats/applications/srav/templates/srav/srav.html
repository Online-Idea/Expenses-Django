{% extends 'base/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load cache %}

{% block headcontent %}

<title>Сравнительная</title>

{% include 'base/daterange_picker.html' %}

{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-xl-12 center">
            <h3 class="logo"><a href="{% url 'srav' %}">Сравнительная</a></h3>

            <!--Выбор периода-->
            <form method="POST" class="period">
                {% csrf_token %}
                {{ form.daterange }}
                <button type="submit" class="btn btn-primary">Показать</button>
                <button type="submit" class="btn btn-primary" formaction="{% url 'download_srav' %}">Скачать</button>


                <!-- Список марок -->
                <details>
                    <summary>Марки</summary>
                    <div class="content">
                        <label for="id_select_all_marks">
                            {{ form.select_all_marks }}
                            Выбрать все
                        </label>
                        {{ form.mark_checkbox }}
                    </div>
                </details>

                <!-- Список регионов -->
                <details>
                    <summary>Регионы</summary>
                    <div class="content">
                        <label for="id_select_all_regions">
                            {{ form.select_all_regions }}
                            Выбрать все
                        </label>
                        {{ form.region_checkbox }}
                    </div>
                </details>

            </form>

            <div class="table-responsive">
                <table id="datatable_autoru_parsed_ad" width="100%" class="table table-striped table-bordered dt-responsive compact nowrap">
                </table>
            </div>

            <script language="javascript">
                $(document).ready(function() {
                    AjaxDatatableViewUtils.initialize_table(
                        $('#datatable_autoru_parsed_ad'),
                        "{% url 'ajax_datatable_autoru_parsed_ad' %}",
                        {
                            // extra_options (example)
							order: [
							    [1, 'desc'], // datetime
							    [2, 'asc'], // region
							    [3, 'asc'], // mark
							    [4, 'asc'], // model
							    [5, 'asc'], // complectation
							    [6, 'asc'], // modification
							    [7, 'asc'], // year
							    [12, 'asc'], // position_actual
							],
							rowGroup: {
								dataSrc: [
								    'datetime',
    								'region',
    								'mark',
    								// 'model',
    								'modification',
    								// 'complectation',
    								// 'year'
    							]
							},
                            fixedHeader: true,
                            responsive: false,
                            full_row_select: true,
                            processing: true,
                            autoWidth: true,
                            scrollX: true,
                            language: {
                                url: '{% static "js/datatables-ru.json" %}'
                            },
                        }, {
                            // extra_data
                            // ...
                        },
                    );
                });
            </script>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        {% if marks_checked %}
            selected_checkboxes({{ marks_checked|safe }}, 'mark_checkbox', 'select_all_marks');
        {% endif %}

        {% if regions_checked %}
            selected_checkboxes({{ regions_checked|safe }}, 'region_checkbox', 'select_all_regions');
        {% endif %}
    });
</script>

{% endblock %}
